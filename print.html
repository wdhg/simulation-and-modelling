<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>60020 Simulation and Modelling</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="preface.html"><strong aria-hidden="true">1.</strong> Preface</a></li><li class="chapter-item expanded "><a href="operational-laws.html"><strong aria-hidden="true">2.</strong> Operational Laws</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operational-laws/the-flow-balance-assumption.html"><strong aria-hidden="true">2.1.</strong> The Flow Balance Assumption</a></li><li class="chapter-item expanded "><a href="operational-laws/open-and-closed-systems.html"><strong aria-hidden="true">2.2.</strong> Open and Closed Systems</a></li><li class="chapter-item expanded "><a href="operational-laws/resources.html"><strong aria-hidden="true">2.3.</strong> Resources</a></li><li class="chapter-item expanded "><a href="operational-laws/the-utilisation-law.html"><strong aria-hidden="true">2.4.</strong> The Utilisation Law</a></li><li class="chapter-item expanded "><a href="operational-laws/littles-law.html"><strong aria-hidden="true">2.5.</strong> Little's Law</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operational-laws/littles-law/the-response-time-law.html"><strong aria-hidden="true">2.5.1.</strong> The Response Time Law</a></li></ol></li><li class="chapter-item expanded "><a href="operational-laws/forced-flow-law.html"><strong aria-hidden="true">2.6.</strong> Forced Flow Law</a></li><li class="chapter-item expanded "><a href="operational-laws/the-service-demand-bottleneck-laws.html"><strong aria-hidden="true">2.7.</strong> The Service Demand/Bottleneck Laws</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="operational-laws/the-service-demand-bottleneck-laws/bottlenecks-and-throughput-bounds.html"><strong aria-hidden="true">2.7.1.</strong> Bottlenecks and Throughtput Bounds</a></li><li class="chapter-item expanded "><a href="operational-laws/the-service-demand-bottleneck-laws/response-time-bounds.html"><strong aria-hidden="true">2.7.2.</strong> Response Time Bounds</a></li><li class="chapter-item expanded "><a href="operational-laws/the-service-demand-bottleneck-laws/performance-optimisation.html"><strong aria-hidden="true">2.7.3.</strong> Performance Optimisation</a></li></ol></li><li class="chapter-item expanded "><a href="operational-laws/traffic-equations.html"><strong aria-hidden="true">2.8.</strong> Traffic Equations</a></li></ol></li><li class="chapter-item expanded "><a href="poisson-processes.html"><strong aria-hidden="true">3.</strong> Poisson Processes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="poisson-processes/properties-of-the-exponential-distribution.html"><strong aria-hidden="true">3.1.</strong> Properties of the Exponential Distribution</a></li><li class="chapter-item expanded "><a href="poisson-processes/merging-poisson-processes.html"><strong aria-hidden="true">3.2.</strong> Merging Poisson Processes</a></li><li class="chapter-item expanded "><a href="poisson-processes/splitting-poisson-processes.html"><strong aria-hidden="true">3.3.</strong> Splitting Poisson Processes</a></li></ol></li><li class="chapter-item expanded "><a href="simulation.html"><strong aria-hidden="true">4.</strong> Simulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="simulation/monte-carlo.html"><strong aria-hidden="true">4.1.</strong> Monte Carlo</a></li><li class="chapter-item expanded "><a href="simulation/discrete-time-simulation.html"><strong aria-hidden="true">4.2.</strong> Discrete-Time Simulation</a></li><li class="chapter-item expanded "><a href="simulation/discrete-event-simulation.html"><strong aria-hidden="true">4.3.</strong> Discrete-Event Simulation (DES)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="simulation/discrete-event-simulation/example-of-a-single-server-fifo-queue.html"><strong aria-hidden="true">4.3.1.</strong> Example of a Single-server FIFO Queue</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">60020 Simulation and Modelling</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<p>This book contains my notes for course 60020 Simulation and Modelling by <a href="http://wp.doc.ic.ac.uk/ajf/">Tony Field</a> and <a href="http://wp.doc.ic.ac.uk/gcasale/">Giuliano Casale</a> at Imperial College London.</p>
<p>This book's source can be found <a href="https://github.com/wdhg/simulation-and-modelling">here</a>. Please feel free to submit any issues / pull requests if anything is wrong or unclear.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operational-laws"><a class="header" href="#operational-laws">Operational Laws</a></h1>
<p>Given an arbitrary system (real, simulated, etc), if measurements can be made upon it then the 'operational laws' link these quantities together.</p>
<p>For example, take an &quot;open&quot; system (more on this later) which has arrivals entering it and completions exiting it:</p>
<pre><code>
  Arrivals        Completions
  -------&gt;(System)----------&gt;

</code></pre>
<p>For an amount of time \( T \), let:</p>
<ul>
<li>\( A \) represent the number of a arrivals</li>
<li>\( C \) represent the number of completions</li>
</ul>
<p>From this, we can begin to determine three relationships:</p>
<ol>
<li>The <em>arrival rate</em> is \( \lambda = {A \over T} \) (arrivals per unit time)</li>
<li>The <em>average inter-arrival time</em> is \( \lambda^{-1} = {T \over A} \) (average amount of time between arrivals)</li>
<li>The <em>throughput (traffic rate)</em> is \( X = {C \over T} \) (completions per unit time)</li>
</ol>
<p>(Note that throughput can be meassured on any arc).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-flow-balance-assumption"><a class="header" href="#the-flow-balance-assumption">The Flow Balance Assumption</a></h1>
<p>Typically the number of arrivals is equal to the number of completions (i.e. \( \lambda = X \)). This is the case when either the number of arrivals and completions are equal (\( A = C \)) or if their difference (\( A - C \)) is small in comparison to them. A system that is in <em>equilibrium</em> (or <em>steady state</em>) must satisfy this.</p>
<p>If over time (as \( T \rightarrow \infty \)) this assumption does not hold, then the system is fundamentally unstable.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="open-and-closed-systems"><a class="header" href="#open-and-closed-systems">Open and Closed Systems</a></h1>
<p>An <strong>open system</strong> is one where jobs can flow in and out of it freely. As a result, the number of jobs in the system can vary over time.</p>
<p>In a <strong>closed system</strong>, the number of jobs circulating around is fixed to some value \( N \). An example of a closed system is:</p>
<pre><code>
  *------------------*
  |                  |
  |                  |
  |                  |
  *----&gt;(System)-----*

</code></pre>
<p>The throughput of this example system is the traffic rate on the looping (ingoing and outgoing) arc.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resources"><a class="header" href="#resources">Resources</a></h1>
<p>If a resource (server, mutex, network port, etc) is busy for a total time of \( B \), then:</p>
<ol>
<li>The <em>utilisation</em> of that resource is \( U = {B \over T} \) (the proportion of time that the resource is being used)</li>
<li>The <em>average service time</em> of each job at the resource is \( S = {B \over C} \)</li>
<li>The <em>service rate</em> is \( \mu = S^{-1} = {C \over B} \)</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-utilisation-law"><a class="header" href="#the-utilisation-law">The Utilisation Law</a></h1>
<p>\[
\begin{align}
U &amp;= {B \over T} \\
&amp;= {B \over T} * {C \over C} \\
&amp;= {B \over C} * {C \over T} \\
&amp;= XS
\end{align}
\]</p>
<p>Since service rates are used a lot, this also comes out to \( U = {X \over \mu} \). Note that because \( B \le T \) and \( U = {B \over T} \) then \( U \le 1 \), so using \( U = {X \over \mu} \) we know that \( {X \over \mu} \le 1 \) so \(X \le \mu \). What this means is that the throughput must always be less than or equal to the service rate for the system to be stable.</p>
<p>Note that in the situation where the arrival rate equals the service rate (\( \lambda = \mu \)) this might seem like it would be a stable system but in general (and depending on the distributions of the inter-arrival times and service times) it is actually unstable (more on this later).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="littles-law"><a class="header" href="#littles-law">Little's Law</a></h1>
<p>Given an open system, if the population of the system (\( A - C \)) was plotted over an observation period \( (0, T) \):</p>
<pre><code>
    A - C
        ^                      Total area = I
       4|
        |
       3|             +-----+                             +---+
        |             |     |                             |   |
       2|       +-----+     +---+       +---+     +-------+   +---+
  I/T- -|- - - -|- - -|- - -|- -|- - - -|- -|- - -|- - - -|- -|- -|
       1|-------+     |     |   +-------+   +-----+       |   |   |
        |       |     |     |   |       |   |     |       |   |   |
       0*---------------------------------------------------------------&gt;
        0       t1    t2   t3  t4      t5   t6    t7      t8  t9  T   Time

</code></pre>
<p>Then the total area under the graph \( I \) would be in &quot;request-seconds&quot;. Then we have:</p>
<ol>
<li>The <em>average number of jobs</em> in the system is \( N = {I \over T} \)</li>
<li>The <em>average response time</em> (the average time each job spends in the system) is \( R = {I \over C} \)</li>
</ol>
<p>Using these, Little's Law can be derived:</p>
<p>\[
\begin{aligned}
N &amp;= {I \over T} \\
&amp;= {I \over T} * {C \over C} \\
&amp;= {C \over T} * {I \over C} \\
&amp;= XR
\end{aligned}
\]</p>
<p>This means that the average number of jobs in a system is equal to the product of the throughput and the average response time.</p>
<p>Little's Law works on <em>any</em> system (or subsystem) in equilibrium. When a system is not yet under equilibrium (say, for example, the system is warming up) then it does not apply.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-response-time-law"><a class="header" href="#the-response-time-law">The Response Time Law</a></h1>
<p>If a closed system has a fixed population of \( N \) users (or customers, packets, jobs, etc) working in &quot;think/compute&quot; mode (i.e. they have a &quot;think time&quot; \( Z \) between the completion of a job and the submission of the next) then this is a special case of Little's Law:</p>
<pre><code>
  N users with think time Z

           +-()-+
           + () +
    *------+ .. +&lt;-----*
    |      +-()-+      |
    |                  |
    |                  |
    |                  |
    *----&gt;(System)-----*

       Response time R

</code></pre>
<p>The average total time for each cycle is \( R + Z \) so from Little's Law: \( N = X * (R + Z) \) or rearranged as \( R = {N \over X} - Z \). Note this <strong>only</strong> applies for the entire closed system, any subsystem will still obey Little's Law.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="forced-flow-law"><a class="header" href="#forced-flow-law">Forced Flow Law</a></h1>
<p>Take a system which contains multiple resources inside it and has \( C \) completions. Consider an arbitrary resource \( k \) inside the system, with \( C_k \) completions:</p>
<pre><code>
      *------------------*
      |           C_k    | C
  ---&gt;| ... --&gt;(k)--&gt; ...|---&gt;
      |                  |
      *------------------*
            System

</code></pre>
<p>Note that \( C_k \) can be <strong>more</strong> than \( C \) if jobs go to resource \( k \) multiple times inside the system.</p>
<p>Let \( V_k = {C_k \over C} \) be the average number of visits each job makes to resource \( k \). Rearranging and dividing by both sides by \( T \) gives \( X_k = V_k X \), where \( X_k \) is the throughput of resource \( k \).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-service-demandbottleneck-laws"><a class="header" href="#the-service-demandbottleneck-laws">The Service Demand/Bottleneck Laws</a></h1>
<p>Given an arbitrary node \( k \) inside an arbitrary system, the <em>Service demand</em> \( D_k = V_k S_k \) is the product of average number of visits \( V_k \) and the average service time \( S_k \).</p>
<p>If we multiply the RHS of this equation by \( X_k \over X_k \):</p>
<p>\[
\begin{aligned}
D_k &amp;= V_k S_k {X_k \over X_k} \\
&amp;= \left( S_k X_k \right) \left( {V_k \over X_k} \right) \\
&amp;= {U_k \over X}
\end{aligned}
\]</p>
<p>where X is the global throughput of the system. Rearranging gives \( U_k = D_k X \), whichs shows that every \( U_k \) and \( V_k \) is linked by the global throughput.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bottlenecks-and-throughtput-bounds"><a class="header" href="#bottlenecks-and-throughtput-bounds">Bottlenecks and Throughtput Bounds</a></h1>
<p>Since \( U_k = D_k X \) and \( U_k \le 1 \), then we know \( X \le {1 \over D_k} \) for every node \( k \) in the system. From this we get that \( X \le {1 \over D_max} \) where \( D_{max} \) is the maximum of \( D_k \).</p>
<p>In a system under heavy load we can say that \( U_{max} \approx 1 \) and \( X \approx {1 \over D_{max}} \). What this means is that \( 1 \over D_{max} \) is the <strong>upper asymptotic bound on throughput under heavy load</strong>, and the resource with the highest demand \( D_{max} \) is the <strong>bottleneck</strong> resource of the system. Note that if the system is open, then \( \lambda = X \) so we also require that \( \lambda \le {1 \over D_{max}} \) for the system to be stable.</p>
<p>In a system under light load jobs are never queued and so the average total time they spend at each resource \( k \) is just \( D_k \) (remember \( D_k \) is the product of the average number of visits per job and the average service time at that resource), so we can say that for the entire system the response time \( R \) is the sum of all service demands: \(R = D_1 + D_2 + ... + D_k \). In a closed system, we can apply this to the response time law:</p>
<p>\[
\begin{aligned}
X &amp;= {N \over (R + Z)} \\
&amp;= {N \over (D + Z)}
\end{aligned}
\]</p>
<p>where \( D = D_1 + D_2 + ... + D_k \). This means that \( N \over (D + Z) \) is the <strong>upper asymptotic bound on throughput under light load</strong>.</p>
<p>Combining these two limits, we can say that in general: \( X \le min \left( {1 \over D_{max}}, {N \over (D + Z)} \right) \). Note that in an open system we say that \( Z = 0 \) but we also recognise that \( N \) is not fixed. The bound still applies, however it is not as tight as in a closed system.</p>
<p>When throughput is plotted against the number of jobs, it typically looks like this:</p>
<p><img src="operational-laws/the-service-demand-bottleneck-laws/./images/throughput-plot.png" alt="A graph of throughput X against number of jobs N being bounded" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="response-time-bounds"><a class="header" href="#response-time-bounds">Response Time Bounds</a></h1>
<p>Just like with throughput, we can calculate the bounds for response time. In a system under high load, since the throughtput is bounded by \( X \le {1 \over D_{max}} \) we know that:</p>
<p>\[
\begin{aligned}
R &amp;= {N \over X} - Z \\
&amp;\le N D_{max} - Z
\end{aligned}
\]</p>
<p>In a system under low load, every job experiences the average service demand at each node without needing to queue. That means that the response time is equal to the sum of the service demands \( D \), thus \( R \ge D \).</p>
<p>Putting these together we get \( R \ge max \left( D, N * D_{max} - Z \right) \). When response time is plotted against number of jobs it looks like:</p>
<p><img src="operational-laws/the-service-demand-bottleneck-laws/./images/response-time-plot.png" alt="A graph of response time R against number of jobs N being bounded" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance-optimisation"><a class="header" href="#performance-optimisation">Performance Optimisation</a></h1>
<p><em>Performance optitmisation</em> means / involves:</p>
<ol>
<li>Understanding / modelling the system</li>
<li>Finding the bottleneck node</li>
<li>Fixing the bottleneck</li>
</ol>
<p>When you fix the bottleneck you change the bounds / limits described in the previous two sections. For example, these two graphs show how optimisations can affect the shape of the throughput \( X \) or response time \( R \) against number of jobs \( N \) plots:</p>
<p><img src="operational-laws/the-service-demand-bottleneck-laws/./images/throughput-optimisation-plot.png" alt="" />
<img src="operational-laws/the-service-demand-bottleneck-laws/./images/response-time-optimisation-plot.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="traffic-equations"><a class="header" href="#traffic-equations">Traffic Equations</a></h1>
<p>Consider an arbitrary system with \( n \) nodes, where each node \( k \) in \( 1 \le k \le n \) has \( C_k \) completions. When the system is at equilibrium, the number of arrivals is equal to the system to the number of completions \( A = C \), and each job arrives exactly once to the system.</p>
<p>Now consider two arbitrary and distinct nodes \( i \) and \( j \) where \( 1 \le i, j \le n \). Assume that a job that comletes at \( i \) has a fixed probability \( r_{ij} \) of moving to node \( j \). Then for any node \( k \), the number of completions \( C_k \) must equal the sum of:</p>
<ol>
<li>the number of arrivals to the system \( A \) multiplied by the probability that an arriving job will move to node \( k \) directly, denoted as \( a_k \).</li>
<li>the sum of the products of every node's number of completions and probability that a job will move to \( k \) (note this includes the cyclic arc from \( k \) to \( k \)).</li>
</ol>
<p>\[
C_k = A a_k + C_1 r_{1k} + C_2 r_{2k} + \ldots + C_n r_{nk}
\]</p>
<p>If both sides are divided by the total number of completions in the system \( C \) we get an equation for the number of visits \(V_k = {C_k \over C} \):</p>
<p>\[
V_k = a_k + V_1 r_{1k} + V_2 r_{2k} + \ldots + V_n r_{nk}
\]</p>
<p>Note that \( A = C \) hence why it disappears from \(A a_k \).</p>
<p>If we divide by the total time \( T \) instead, we get an equation for the node throughput \( X_k \):</p>
<p>\[
X_k = \gamma_k + X_1 r_{1k} + X_2 * r_{2k} + \ldots + X_n * r_{nk}
\]</p>
<p>where \( \gamma_k = X a_k \) is the direct contribution to throughput from external arrivals.</p>
<p>We can now take these equations and turn them into vector equations:</p>
<p>\[
\vec{V} (\boldsymbol{I} - \boldsymbol{R}) = \vec{a}
\]
\[
\vec{X} (\boldsymbol{I} - \boldsymbol{R}) = \vec{\gamma}
\]</p>
<p>where:</p>
<ul>
<li>\( \vec{V} \) is the vector of number of visits for each node.</li>
<li>\( \boldsymbol{I} \) is the identity matrix.</li>
<li>\( \boldsymbol{R} \) is the maxtrix of probabilities that a job goes from node \( i \) to node \( j \).</li>
<li>\( \vec{\gamma} \) is the vector of direct contributions to throughput from external arrivals for each node.</li>
</ul>
<p>Note that often we use arrival rate of node \( i \) (denoted as \( λ_i \)) instead of throughput. Since arrival rate is the same as throughput, we can write:</p>
<p>\[
\vec{\lambda} (\boldsymbol{I} - \boldsymbol{R}) = \vec{\gamma}
\]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="poisson-processes"><a class="header" href="#poisson-processes">Poisson Processes</a></h1>
<p>A <em>Poisson arrival processes</em> is an arrival stream where the inter-arrival times \( T \) are both independent and <em>exponentially distributed</em>:</p>
<p>\[
P(T \le t) = 1 - e^{(-\lambda t)}
\]</p>
<p>Here, \( \lambda \) is often called the processes' &quot;rate&quot; parameter and is equal to the reciprocal of the average inter-arrival time.</p>
<p>Since the inter-arrival times are exponentially distributed, for a fixed time window the number of arrivals is <em>poisson distributed</em>:</p>
<p>\[
P(A_t = n) = {(\lambda t)^n * e^{-λt} \over n!}
\]</p>
<p>where \( A_t \) is the number of arrivals for time interval \( t \).</p>
<p>Poisson processes are often an effective approximation for real world random arrival processes as arrivals are typically:</p>
<ol>
<li>independent to each other.</li>
<li>ignorant of previous arrivals and the state of the system they are arriving at.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="properties-of-the-exponential-distribution"><a class="header" href="#properties-of-the-exponential-distribution">Properties of the Exponential Distribution</a></h1>
<p>Here are three properties of the exponential distribution that will be useful to recap:</p>
<ol>
<li>The exponential distribution is <em>memoryless</em>, meaning that the future is independent to the past:</li>
</ol>
<p>\[
\begin{aligned}
P(X \le t + s | X &gt; t) &amp;= 1 - {P(X \gt t + s \land X \gt t) \over P(X &gt; t)} \\
&amp;= 1 - {P(X \gt t + s) \over P(X \gt t)} \\
&amp;= 1 - {e^{-\lambda (t + s)} \over e^{-λt}} \\
&amp;= 1 - {e^{-\lambda s} * e^{-\lambda t} \over e^{-\lambda t}} \\
&amp;= 1 - e^{-\lambda s} \\
&amp;= P(X \le s)
\end{aligned}
\]</p>
<ol start="2">
<li>If \( X_1 \sim exp(\lambda_1) \) and \( X_2 \sim exp(\lambda_2) \) then \( min(X_1, X_2) \sim exp(\lambda_1 + \lambda_2) \):</li>
</ol>
<p>\[
\begin{aligned}
P(min(X_1, X_2) \le t) &amp;= 1 - P(min(X_1, X_2) \gt t) \\
&amp;= 1 - P(X_1 \gt t \land X_2 \gt t) \\
&amp;= 1 - e^{-\lambda_1 t} e^{-\lambda_2 t} \\
&amp;= 1 - e^{-t(\lambda_1 + \lambda_2)}
\end{aligned}
\]</p>
<ol start="3">
<li>If \( X_1 \sim exp(\lambda_1) \) and \( X_2 \sim exp(\lambda_2) \) then</li>
</ol>
<p>\[
\begin{aligned}
P(X_1 &lt; X_2) &amp;= \int_0^{\infty} P(X_1 \lt X_2 | X_1 = x) * \lambda_1 * e^{-\lambda_1 x} dx \\
&amp;= \int_0^{\infty} P(X_2 \gt x) * λ_1 * e^{-\lambda_1 * x} dx \\
&amp;= \int_0^{\infty} e^{-\lambda_2 x} * \lambda_1 * e^{-\lambda_1 x} dx \\
&amp;= \lambda_1 \int_0^{\infty} e^{-x(\lambda_1 + \lambda_2)} dx \\
&amp;= \lambda_1 \left[ {-e^{-x(\lambda_1 + \lambda_2)} \over \lambda_1 + \lambda_2}  \right]_0^\infty \\
&amp;= \lambda_1 {0 - (-1) \over \lambda_1 + \lambda_2}  \\
&amp;= {\lambda_1 \over \lambda_1 + \lambda_2} \\
\end{aligned}
\]</p>
<p>and therefore by swapping \( X_1 \) and \( X_2 \):</p>
<p>\[
P(X_2 &lt; X_1) = {\lambda_2 \over \lambda_1 + \lambda_2}
\]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="merging-poisson-processes"><a class="header" href="#merging-poisson-processes">Merging Poisson Processes</a></h1>
<p>When two independent Poisson processes with rates \( λ_1 \) and \( λ_2 \) are merged together, the result is also a Poisson process with rate \( λ_1 + λ_2 \).</p>
<h3 id="proof"><a class="header" href="#proof">Proof</a></h3>
<p>Let:</p>
<ul>
<li>\( T_1 \) and \( T_2 \) be the time until the next arrival for two Poisson processes.</li>
<li>\( T \) be the time until the next arrival for the merged process.</li>
</ul>
<p>Then we get:</p>
<p>\[
\begin{aligned}
P(T \le t) &amp;= P(min(T_1, T_2) \le t) \\
&amp;= 1 - e^{-t(λ_1 + λ_2)}
\end{aligned}
\]</p>
<p>Note that this is described more in detail in the <a href="poisson-processes/./properties-of-the-exponential-distribution.html">Properties of the Exponential Distribution section</a>.</p>
<p>This shows that the inter-arrival times of the merged process is exponential distributed, and so the merged process is Poisson.</p>
<h2 id="generalised-merging"><a class="header" href="#generalised-merging">Generalised Merging</a></h2>
<p>We can also generalise this for \( n \ge 2 \) processes. Consider a binary tree of merges. Since the output of a merge is Poisson, it can be merged with another process, thus creating a chain of merges:</p>
<pre><code>  ()()
   \/ merge
   ()()
    \/ merge
    ()()
     \/ merge
     ()
</code></pre>
<h2 id="probability-of-arrival-orders"><a class="header" href="#probability-of-arrival-orders">Probability of Arrival Orders</a></h2>
<p>The probability that the first arrival will come from the first stream is given by:</p>
<p>\[
P(T_1 \lt T_2) = {\lambda_1 \over \lambda_1 + \lambda_2}
\]</p>
<p>and likewise the probability that the first arrival is from the second stream is:</p>
<p>\[
P(T_2 \lt T_1) = {\lambda_2 \over \lambda_1 + \lambda_2}
\]</p>
<p>Note that this is described more in detail in the <a href="poisson-processes/./properties-of-the-exponential-distribution.html">Properties of the Exponential Distribution section</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="splitting-poisson-processes"><a class="header" href="#splitting-poisson-processes">Splitting Poisson Processes</a></h1>
<p>If we split a Poisson process with rate \( \lambda \) into two streams, such that there is:</p>
<ul>
<li>chance \( p \) (\( 0 \le p \le 1\)) that the arrival will go to the first stream.</li>
<li>chance \( 1 - p \0 that the arrival will go into the second stream.</li>
</ul>
<p>then the resulting two processes will independent Poisson processes with rates \( \lambda p \) and \( \lambda (1 - p) \) respectively. From this we can say that:</p>
<p>\[
P(N_1(t) = m) = {(\lambda t p)^m * e^{-\lambda t p} \over m!}
\]</p>
<p>and</p>
<p>\[
P(N_2(t) = n) = {(\lambda t (1 - p))^n * e^{-\lambda t (1 - p)} \over n!}
\]</p>
<p>where:</p>
<ul>
<li>\( t \) is the time interval.</li>
<li>\( N_1(t) \), \( N_2(t) \) are the number of arrivals seen at both output streams respectively during interval \( t \).</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="simulation"><a class="header" href="#simulation">Simulation</a></h1>
<p>Broadly there are three classes of simulation: </p>
<ul>
<li>Monte Carlo.</li>
<li>Discrete time.</li>
<li>Discrete event.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monte-carlo"><a class="header" href="#monte-carlo">Monte Carlo</a></h1>
<p>Run multiple 'one shot' experiments using random numbers (no state, just make random observations and repeat many times) and aggregate the results.</p>
<p>For example, \( \pi \) can be estimated using Monte Carlo simulation:</p>
<ol>
<li>Take a circle of radius \( r \) and a square with side length \( 2r \).</li>
<li>Pick random points inside this shape.</li>
<li>Calculate <code>No. in circle / No. in square</code> to estimate \( \pi \over 4 \) (by the ratio of the areas \( \pi r^2 \over (2 \pi)^2 \) )</li>
</ol>
<p><img src="simulation/./images/monte-carlo-pi.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="discrete-time-simulation"><a class="header" href="#discrete-time-simulation">Discrete-Time Simulation</a></h1>
<p>Given a state transition system (e.g. nodes with arcs) take \( n \) steps randomly throught the system, moving from one state to the next in each discrete step. There may or may not be a notion of time in the discrete steps made.</p>
<p>For example, consider a game of Monopoly where you want to find the probability of landing on each board position in the game. This can be done by starting at GO, simulating \( n \) dice rolls, following the rules of the game (including chance and community chest cards), and counting how many times each tile is landed on.</p>
<p><img src="simulation/./images/monopoly.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="discrete-event-simulation-des"><a class="header" href="#discrete-event-simulation-des">Discrete-Event Simulation (DES)</a></h1>
<p>Similar to discrete time, steps are made through a state transition system, but instead these steps are triggered by discrete events in continuous time. To do this, there is a single global clock that dictates the virtual time of the simulation. The triggering events are scheduled in order of time, and when an event occurs the global clock is updated to the timestamp of the event.</p>
<pre><code>
                            Virtual  ---&gt; Direction of time
                             Time
                               |
                               V
               |---*------*----*--------*---*-------*------&gt; ...
    Timestamp: 0   3      8    9       19  21      28

</code></pre>
<p>Events can also update the state of the simulation and queue future events.</p>
<p>Since events don't occur in order of generation but rather in order of their randomly sampled timestamps, discrete-event simulation is therefore an asychronous model of time. Discrete-time simulation on the other hand is a synchronous model of time as events occur in order of their generation (e.g. in a Monopoly simulation, the state gets updated as soon as the dice is rolled).</p>
<h2 id="in-practice"><a class="header" href="#in-practice">In Practice</a></h2>
<p>In practice a discrete-event simulation has:</p>
<ul>
<li>Continuous time (i.e. a floating-point number)</li>
<li>A collection of variables (both discrete and continuous) that constitute the simulation state.</li>
<li>A priority queue of events, ordered by their timestamp.</li>
<li>A scheduler adds new events to the priority queue.</li>
<li>A descheduler removes events from the priority queue.</li>
<li>Measurement code will also be required to get output data from the simulation.</li>
</ul>
<h2 id="evolution-of-time"><a class="header" href="#evolution-of-time">Evolution of Time</a></h2>
<pre><code>    History &lt;-- Virtual --&gt; Future
                 Time
                   |
                   V
                Event 1           Event 2
    |--------------*-----------------*------------------&gt; ...
                  t1                t2
                   |                 |
                   |&lt;---------------&gt;|
                      Δt = t2 - t1
</code></pre>
<p>In the diagram above, Event 1 at time \( t_1 \) schedules Event 2 at time \( t_2 \). To do this, an amount of time \( \Delta t \) is added to \( t_1 \) to get \( t_2 \). \( \Delta t \) is thus the interarrival time of the events, and so it can be modelled as a random variable. We'll need to be able to sample \( \Delta t \) by sampling its distribution (more on this later).</p>
<h2 id="discrete-time-to-discrete-event-example"><a class="header" href="#discrete-time-to-discrete-event-example">Discrete-Time to Discrete-Event Example</a></h2>
<p>Using the Monopoly example, to change it from a discrete time simulation to a discrete event simulation we can model the move times explicitly using some random variable \( T \) with a specified distribution. Then at each move, we can add to the current time a sample of this distribution to progress through time (e.g. <code>current time + sample of T</code>). However if we want to simulate \( P \) players who roll their dice independently, we will need to think of a way to resolve the issue of updating time and shared resources (e.g. cards). This can be done using a sequence of move events in time order and controlled access to shared resources (e.g. via queueing).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-of-a-single-server-fifo-queue"><a class="header" href="#example-of-a-single-server-fifo-queue">Example of a Single-server FIFO Queue</a></h1>
<p>Consider a finite single-server queue with a mean interarrival time \( \lambda \), mean service rate \( \mu \), and queue capacity of \( N \):</p>
<p><img src="simulation/discrete-event-simulation/./images/single-server-queue.png" alt="A single-server queue diagram" /></p>
<p>We can model this queue using the following graph, where the number of each state represents the length of the queue:</p>
<p><img src="simulation/discrete-event-simulation/./images/single-server-queue-state-diagram.png" alt="The state diagram of a single-server queue of length N" /></p>
<p>As shown in this diagram, two events are required to model this queue: <code>Arrival</code> and <code>Completion</code>.</p>
<p>The timeline priority queue will contain <code>Arrival</code> and <code>Completion</code> events. Completing each event will update the state depending on the state of the simulation, described by the following rules / pseudocode:</p>
<pre><code>Let State = 0
Let N be the max queue length
Let there be a priority queue

Queue an Arrival at the start of the simulation
Get next event in queue

If the event is an Arrival:

  State += 1

  If State &lt; N:
    Queue a new Arrival

  If State == 1:
    Queue a new Completion

If the event is a Completion:

  State -= 1

  If State == N - 1:
    Queue a new Arrival

  If State &gt; 0:
    Queue a new Completion
</code></pre>
<p>Note that in this example the <code>Queue</code> steps implicitly sample the interarrival time for the specific events interarrival time distribution.</p>
<p><img src="simulation/discrete-event-simulation/./images/example-timeline.png" alt="An example timeline" /></p>
<p>Suppose a <code>Clear</code> event also needs to be added, which will reset the state to \( 0 \). If the state is not equal to \( 0 \) then </p>
<pre><code>Queue a Clear at the start of the simulation

If the event is a Clear:

  If state &gt; 0:
    Dequeue the Completion event

  If state == N:
    Queue a new arrival

  State = 0

  Queue a new Clear
</code></pre>
<p><img src="simulation/discrete-event-simulation/./images/single-server-queue-clear-example.png" alt="The state diagram with clear events added" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
    </body>
</html>
